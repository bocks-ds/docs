const env = require('env_vars');
const config = require('../docs/config')

class ABCDoc {

    constructor(title, source_directory, target_file) {
        if (this.constructor === ABCDoc) {
            throw new TypeError('Abstract class "ABCDoc" cannot be instantiated directly.'); 
        }
        this.title = title
        this.target_file = target_file
        this.source_dir = source_directory
        this.doc = this.get_doc()
        this.write().then(_ => {
            this.check_written()
        }).catch(err => {env.logger.debug(err)})
    }

    async write() {
        let title = this.title
        let target_file = this.target_file
        fs.writeFile(target_file, this.doc, function (err) {
            if (err) return console.log(err);
            env.logger.info(`${title} written to ${target_file}.`);
        });
    }

    base_doc() {
        return `${this._title()}\n${this._description()}\n*****\n\n`
    }

    _title() {
        let overline = '='.repeat(this.title.length)
        return `${overline}\n${this.title}\n${overline}\n`
    }

    _description() {
        return config[this.title].description + '\n'
    }

    check_written() {
        fs.readFile(this.target_file, (err, data) => {
            this.data = data
            if (err) throw err;
        });
        if (this.data != this.doc) {
            let err = `File readable, but data does not match:\n${this.data}\n----------\n${this.doc}`
            throw Error(err)
        }
    }
}

module.exports = ABCDoc